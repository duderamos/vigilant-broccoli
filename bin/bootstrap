#!/usr/bin/env sh

docker-compose build base

docker-compose build web-dev

[[ "$?" -eq "0" ]] && \
  docker-compose run --no-deps --rm --entrypoint "" web-dev \
  rails new . --force -d postgresql -j esbuild --skip-test --skip-system-test --skip-hotwire

[[ "$?" -eq "0" ]] && \
  sed -i 's|rails server -p 3000$|rails server -p 3000 -b 0.0.0.0|g' Procfile.dev
